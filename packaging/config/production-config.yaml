version: 0.1.14
server:
  http_port: 5000
  https_port: 5001
ssl:
  enabled: true
  generate_ssl: true
  key_path: /etc/zoneweaver-api/ssl/server.key
  cert_path: /etc/zoneweaver-api/ssl/server.crt
cors:
  whitelist:
    - http://localhost:3000
    - https://localhost:3001
    - http://localhost:3001
    - https://localhost:5001
database:
  dialect: sqlite
  storage: /var/lib/zoneweaver-api/database/database.sqlite
  logging: false
  sqlite_options:
    # SQLite-specific performance and reliability settings
    journal_mode: WAL              # Write-Ahead Logging for concurrent reads (WAL, DELETE, TRUNCATE, PERSIST, MEMORY, OFF)
    synchronous: NORMAL            # Synchronization level (OFF, NORMAL, FULL, EXTRA)
    cache_size_mb: 128             # Cache size in MB (will be converted to negative KB value for SQLite)
    temp_store: MEMORY             # Temporary table storage (MEMORY, FILE, DEFAULT)
    mmap_size_mb: 512              # Memory-mapped I/O size in MB
    busy_timeout_ms: 30000         # Timeout for locked database in milliseconds
    wal_autocheckpoint: 1000       # Checkpoint WAL after N pages
    optimize: true                 # Run PRAGMA optimize on connection
    # Connection pool settings for SQLite
    pool:
      max: 10                      # Maximum connections (multiple readers allowed with WAL)
      min: 2                       # Minimum connections to keep ready
      acquire_timeout_ms: 60000    # Timeout to acquire connection
      idle_timeout_ms: 30000       # Idle connection timeout
      evict_interval_ms: 5000      # Check for idle connections interval
    # Retry configuration for busy database
    retry:
      max_retries: 5               # Maximum retry attempts for SQLITE_BUSY/LOCKED
      backoff_base_ms: 100         # Initial retry delay
      backoff_exponent: 1.5        # Exponential backoff multiplier
api_keys:
  bootstrap_enabled: true
  bootstrap_auto_disable: true
  key_length: 64
  hash_rounds: 12
stats:
  public_access: false
zones:
  discovery_interval: 300
  auto_discovery: true
  max_concurrent_tasks: 5
  task_timeout: 300
  orphan_retention: 7
  default_pagination_limit: 50
provisioning:
  install_tools: true
cleanup:
  interval: 300
vnc:
  web_port_range_start: 8000
  web_port_range_end: 8100
  session_timeout: 1800
  cleanup_interval: 300
  bind_address: 127.0.0.1
  max_concurrent_sessions: 10
host_monitoring:
  enabled: true
  auto_enable_network_accounting: true
  network_accounting_file: /var/log/net.log
  intervals:
    network_config: 10
    network_stats: 10
    network_usage: 10
    storage: 300
    storage_frequent: 10
    device_discovery: 60
    system_metrics: 30
  retention:
    network_stats: 7
    network_usage: 30
    network_config: 90
    storage: 90
    cpu_stats: 7
    memory_stats: 7
    system_metrics: 90
    tasks: 30
  error_handling:
    max_consecutive_errors: 5
    retry_delay: 30
    reset_error_count_after: 3600
  performance:
    max_concurrent_scans: 3
    command_timeout: 30
    batch_size: 100
logging:
  level: warn  # Production log level - errors and warnings only
  console_enabled: false  # Disable console output in production
  log_directory: /var/log/zoneweaver-api  # Configurable log directory
  file_rotation:
    max_size: 50m  # Max size per file (can use k, m, g units)
    max_files: 14d  # Keep 14 days of logs
    compress: true  # Compress archived logs with gzip
    date_pattern: YYYY-MM-DD  # Daily rotation pattern
  performance_threshold_ms: 1000  # Only log operations slower than this
  categories:
    monitoring: info  # More verbose for monitoring
    database: warn    # Only errors and warnings
    tasks: info       # Task execution info
    performance: warn # Only slow operations
    api_requests: info # API request tracking
    filesystem: warn  # File operations warnings
    auth: info        # Authentication events
    websocket: warn   # WebSocket connection issues
reconciliation:
  enabled: true
  interval: 3600
  log_level: warn
api_docs:
  enabled: true
fault_management:
  enabled: true
  cache_interval: 3600  # 1 hour cache for fmadm faulty results
  timeout: 30
  max_faults_displayed: 50
system_logs:
  enabled: true
  max_lines: 1000  # Default log read limit
  default_tail_lines: 100
  timeout: 30
  max_concurrent_streams: 10  # Maximum concurrent WebSocket log streams
  stream_session_timeout: 3600  # Log stream session timeout in seconds
  allowed_paths:
    - "/var/log"
    - "/var/adm"
    - "/var/fm/fmd"
  security:
    max_file_size_mb: 100  # Prevent reading huge files
    forbidden_patterns:
      - "*.pid"
      - "*.lock"
      - "*/private/*"
file_browser:
  enabled: true
  upload_size_limit_gb: 50  # Maximum file upload size
  security:
    max_file_size_mb: 51200  # 50GB for uploads
    max_edit_size_mb: 100    # 100MB for text editing
    max_directory_entries: 1000  # Prevent huge directory listings
    prevent_traversal: true
    forbidden_paths:
      - "/dev"
      - "/devices" 
      - "/system"
      - "/platform"
      - "/kernel"
      - "/proc"              # Virtual filesystem - confusing in browser
    forbidden_patterns:
      - "*/dev/*"
      - "*/devices/*"
      - "/system/*"
      - "*/platform/*"
      - "*/kernel/*"
      - "*/proc/*"
  archive:
    enabled: true
    max_archive_size_mb: 10240  # 10GB max archive size
    supported_formats: ["zip", "tar", "tar.gz", "tar.bz2", "gz"]
artifact_storage:
  enabled: true
  checksums:
    enabled: true
    algorithm: "sha256"  # md5, sha1, sha256
    detect_duplicates: true
    skip_duplicate_uploads: false  # warn vs reject duplicates
  scanning:
    auto_scan_after_upload: true
    auto_scan_after_download: true  
    periodic_scan_interval: 300  # seconds (5 minutes)
    supported_extensions:
      iso: [".iso"]
      image: [".vmdk", ".raw", ".vdi", ".qcow2", ".img", ".ova", ".ovf"]
  paths:
    - name: "Primary ISO Storage"
      path: "/data/isos"
      type: iso
      enabled: true
    - name: "Image Storage"
      path: "/data/images" 
      type: image
      enabled: true
  security:
    max_download_size_gb: 50  # Maximum URL download size
    download_timeout_minutes: 60
    max_upload_size_gb: 50  # Maximum file upload size
    upload_timeout_minutes: 120  # Timeout for large uploads
    max_form_field_size_mb: 10  # Maximum form field size in MB
    max_files_per_upload: 1  # Maximum number of files per upload
    max_form_fields: 10  # Maximum number of form fields
    upload_session_timeout_hours: 2  # Upload session expiration time
  cleanup:
    enabled: true
    orphaned_files_retention_days: 30
    failed_downloads_cleanup: true
