<!-- Custom head content for ZoneWeaver API Documentation -->
<link rel="icon" type="image/x-icon" href="{{ '/assets/images/favicon.ico' | relative_url }}">
<link rel="apple-touch-icon" sizes="192x192" href="{{ '/assets/images/logo192.png' | relative_url }}">
<link rel="apple-touch-icon" sizes="512x512" href="{{ '/assets/images/logo512.png' | relative_url }}">

<!-- Dynamic version loading for releases and security pages -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  // Releases page version loading
  if (window.location.pathname.includes('/releases/')) {
    var releaseDiv = document.getElementById('latest-release');
    if (releaseDiv) {
      fetch('https://raw.githubusercontent.com/Makr91/zoneweaver-api/refs/heads/main/package.json')
        .then(function(response) { return response.json(); })
        .then(function(data) {
          releaseDiv.innerHTML = '<p><strong>Version v' + data.version + '</strong> - Current Build</p>';
          var p5pLink = document.querySelector('a[href*="zoneweaver-api.p5p"]');
          if (p5pLink) {
            p5pLink.href = 'https://github.com/Makr91/zoneweaver-api/releases/latest/download/zoneweaver-api-' + data.version + '.p5p';
          }
        });
    }
  }
  
  // Security page supported versions loading
  if (window.location.pathname.includes('/security/')) {
    var versionsDiv = document.getElementById('supported-versions');
    if (versionsDiv) {
      fetch('https://api.github.com/repos/Makr91/zoneweaver-api/releases')
        .then(function(response) { return response.json(); })
        .then(function(releases) {
          var stableReleases = releases.filter(function(release) { 
            return !release.draft && !release.prerelease; 
          }).slice(0, 5);
          
          if (stableReleases.length === 0) {
            versionsDiv.innerHTML = '<p><em>No stable releases available yet.</em></p>';
            return;
          }
          
          var html = '<table><thead><tr><th>Version</th><th>Release Date</th><th>Supported</th><th>Download</th></tr></thead><tbody>';
          
          for (var i = 0; i < stableReleases.length; i++) {
            var release = stableReleases[i];
            var releaseDate = new Date(release.published_at).toLocaleDateString();
            var isSupported = i < 3;
            var supportIcon = isSupported ? '✅' : '❌';
            
            html += '<tr>';
            html += '<td><a href="' + release.html_url + '">' + release.tag_name + '</a></td>';
            html += '<td>' + releaseDate + '</td>';
            html += '<td>' + supportIcon + '</td>';
            html += '<td><a href="' + release.html_url + '">Download</a></td>';
            html += '</tr>';
          }
          
          html += '</tbody></table>';
          html += '<p><em>Last updated: ' + new Date().toLocaleDateString() + '</em></p>';
          
          versionsDiv.innerHTML = html;
        })
        .catch(function(error) {
          console.error('Failed to load releases:', error);
          versionsDiv.innerHTML = '<p><em>Unable to load version information. Please check the releases page for current versions.</em></p>';
        });
    }
  }
});
</script>
